








let db = [
	{
	  "date": "2017-10-16 12:07:07",
	  "name": "Расход",
	  "id": 564564867361367,
	  "image": "http://ecosned.ru/image/cache/catalog/categories/iz_fermerskogo_moloka/tvorog/7/ge-catalog-categories-iz_fermerskogo_moloka-tvorog-tvorozhnaya_massa_s_kuragoy-800x800.jpg",
	  "name__1": "Творог 9% с курагой",
	  "price": 121,
	  "quantity": 45,
	  "removed": 0
	},
	{
	  "date": "2017-10-16 12:07:07",
	  "name": "Расход",
	  "id": 564564867361367,
	  "image": "https://www.utkonos.ru/images/photo/3265/3265004H.jpg",
	  "name__1": "Молочный Яблоко 100",
	  "price": 25.1,
	  "quantity": 44,
	  "removed": 0
	},
	{
	  "date": "2017-10-16 12:07:07",
	  "name": "Расход",
	  "id": 564564867361367,
	  "image": "http://irecommend.ru/sites/default/files/imagecache/copyright1/user-images/299388/Ydfgl76IXe0nEM2gO6Ww.JPG",
	  "name__1": "Молочный Традиция 100",
	  "price": 115,
	  "quantity": 62,
	  "removed": 0
	},
	{
	  "date": "2017-10-16 12:07:07",
	  "name": "Расход",
	  "id": 564564867361367,
	  "image": "",
	  "name__1": "Виноград 0,3л",
	  "price": 65,
	  "quantity": 87,
	  "removed": 0
	},
	{
	  "date": "2017-10-16 12:07:07",
	  "name": "Расход",
	  "id": 564564867361367,
	  "image": "https://mariupolcena.com/files/products/9ff44136e6ccb0afb404ad26f727e67d.jpeg",
	  "name__1": "Русская картошка чедар 50",
	  "price": 46.3,
	  "quantity": 86,
	  "removed": 0
	},
	{
	  "date": "2017-10-16 12:07:07",
	  "name": "Расход",
	  "id": 564564867361367,
	  "image": "https://images.ua.prom.st/50389447_w640_h640_ncheskaya_s_grushej_200_g..jpg",
	  "name__1": "Молочный Груша 200",
	  "price": 180,
	  "quantity": 80,
	  "removed": 0
	},
	{
	  "date": "2017-10-16 12:07:07",
	  "name": "Расход",
	  "id": 564564867361367,
	  "image": "https://www.utkonos.ru/images/photo/3054/3054289H.jpg",
	  "name__1": "Аленка карамель 100г Акционный товар Большая скидка",
	  "price": 73.9,
	  "quantity": 94,
	  "removed": 0
	},
	{
	  "date": "2017-10-16 12:07:07",
	  "name": "Расход",
	  "id": 564564867361367,
	  "image": "https://www.utkonos.ru/images/photo/3176/3176192H.jpg",
	  "name__1": "Сыр 125г",
	  "price": 131,
	  "quantity": 83,
	  "removed": 0
	},
	{
	  "date": "2017-10-16 15:09:08",
	  "name": "Расчет",
	  "id": 564564867361368,
	  "image": "http://карапузик.com.images.1c-bitrix-cdn.ru/upload/iblock/b28/b28f089d41db757b74cfebfe21609228.jpg",
	  "name__1": "Яблоко-Виноград 0,5л",
	  "price": 44,
	  "quantity": 20,
	  "removed": 0
	},
	{
	  "date": "2017-10-16 15:09:08",
	  "name": "Расчет",
	  "id": 564564867361368,
	  "image": "https://images.ua.prom.st/50389447_w640_h640_ncheskaya_s_grushej_200_g..jpg",
	  "name__1": "Молочный Груша 200",
	  "price": 180,
	  "quantity": 65,
	  "removed": 0
	},
	{
	  "date": "2017-10-16 15:09:08",
	  "name": "Расчет",
	  "id": 564564867361368,
	  "image": "http://ecosned.ru/image/cache/catalog/categories/iz_fermerskogo_moloka/tvorog/7/ge-catalog-categories-iz_fermerskogo_moloka-tvorog-tvorozhnaya_massa_s_kuragoy-800x800.jpg",
	  "name__1": "Творог 9% с курагой",
	  "price": 121,
	  "quantity": 41,
	  "removed": 0
	},
	{
	  "date": "2017-10-16 15:09:08",
	  "name": "Расчет",
	  "id": 564564867361368,
	  "image": "https://www.komus.ru/medias/sys_master/root/hd3/h93/9286922043422.jpg",
	  "name__1": "Молочный Изюм 100",
	  "price": 102,
	  "quantity": 72,
	  "removed": 0
	},
	{
	  "date": "2017-10-16 15:09:08",
	  "name": "Расчет",
	  "id": 564564867361368,
	  "image": "",
	  "name__1": "Виноград 0,3л",
	  "price": 65,
	  "quantity": 39,
	  "removed": 0
	},
	{
	  "date": "2017-10-16 18:11:09",
	  "name": "Приход",
	  "id": 564564867361369,
	  "image": "http://irecommend.ru/sites/default/files/imagecache/copyright1/user-images/299388/Ydfgl76IXe0nEM2gO6Ww.JPG",
	  "name__1": "Молочный Традиция 100",
	  "price": 115,
	  "quantity": 60,
	  "removed": 0
	},
	{
	  "date": "2017-10-16 18:11:09",
	  "name": "Приход",
	  "id": 564564867361369,
	  "image": "https://www.utkonos.ru/images/photo/3054/3054289H.jpg",
	  "name__1": "Аленка карамель 100г Акционный товар Большая скидка",
	  "price": 73.9,
	  "quantity": 99,
	  "removed": 0
	},
	{
	  "date": "2017-10-16 18:11:09",
	  "name": "Приход",
	  "id": 564564867361369,
	  "image": "https://mariupolcena.com/files/products/9ff44136e6ccb0afb404ad26f727e67d.jpeg",
	  "name__1": "Русская картошка чедар 50",
	  "price": 46.3,
	  "quantity": 51,
	  "removed": 0
	},
	{
	  "date": "2017-10-16 18:11:09",
	  "name": "Приход",
	  "id": 564564867361369,
	  "image": "https://www.utkonos.ru/images/photo/3117/3117496H.jpg",
	  "name__1": "Русская картошка икра 50",
	  "price": 33.1,
	  "quantity": 15,
	  "removed": 0
	},
	{
	  "date": "2017-11-01 12:09:03",
	  "name": "Приход",
	  "id": 564564867361360,
	  "image": "https://images.ua.prom.st/50389447_w640_h640_ncheskaya_s_grushej_200_g..jpg",
	  "name__1": "Молочный Груша 200",
	  "price": 180,
	  "quantity": 96,
	  "removed": 0
	},
	{
	  "date": "2017-11-01 12:09:03",
	  "name": "Приход",
	  "id": 564564867361360,
	  "image": "",
	  "name__1": "Парус апельсин 1л",
	  "price": 150,
	  "quantity": 89,
	  "removed": 1
	},
	{
	  "date": "2017-11-01 12:09:03",
	  "name": "Приход",
	  "id": 564564867361360,
	  "image": "https://www.utkonos.ru/images/photo/3265/3265004H.jpg",
	  "name__1": "Молочный Яблоко 100",
	  "price": 25.1,
	  "quantity": 9,
	  "removed": 0
	},
	{
	  "date": "2017-11-03 13:11:06",
	  "name": "Приход",
	  "id": 564564867361361,
	  "image": "https://mariupolcena.com/files/products/9ff44136e6ccb0afb404ad26f727e67d.jpeg",
	  "name__1": "Русская картошка чедар 50",
	  "price": 46.3,
	  "quantity": 62,
	  "removed": 0
	},
	{
	  "date": "2017-11-03 13:11:06",
	  "name": "Приход",
	  "id": 564564867361361,
	  "image": "http://produkty-online.ru/wa-data/public/shop/products/31/83/18331/images/1359/1359.970.jpg",
	  "name__1": "Молочный Сказка 100",
	  "price": 39,
	  "quantity": 67,
	  "removed": 0
	},
	{
	  "date": "2017-11-03 13:11:06",
	  "name": "Приход",
	  "id": 564564867361361,
	  "image": "https://www.utkonos.ru/images/photo/3139/3139296H.jpg",
	  "name__1": "Тоник 0,5л",
	  "price": 63,
	  "quantity": 51,
	  "removed": 0
	},
	{
	  "date": "2017-11-03 13:11:06",
	  "name": "Приход",
	  "id": 564564867361361,
	  "image": "https://www.komus.ru/medias/sys_master/root/hd3/h93/9286922043422.jpg",
	  "name__1": "Молочный Изюм 100",
	  "price": 102,
	  "quantity": 4,
	  "removed": 0
	},
	{
	  "date": "2017-11-03 13:11:06",
	  "name": "Приход",
	  "id": 564564867361361,
	  "image": "http://ecosned.ru/image/cache/catalog/categories/iz_fermerskogo_moloka/tvorog/7/ge-catalog-categories-iz_fermerskogo_moloka-tvorog-tvorozhnaya_massa_s_kuragoy-800x800.jpg",
	  "name__1": "Творог 9% с курагой",
	  "price": 121,
	  "quantity": 60,
	  "removed": 0
	},
	{
	  "date": "2017-11-03 13:11:06",
	  "name": "Приход",
	  "id": 564564867361361,
	  "image": "",
	  "name__1": "Виноград 0,3л",
	  "price": 65,
	  "quantity": 61,
	  "removed": 0
	},
	{
	  "date": "2017-11-03 13:11:06",
	  "name": "Приход",
	  "id": 564564867361361,
	  "image": "http://xn--4-8sbu.xn--p1ai/thumb/4KQdJOhw0Uu5AnP0PPIrMQ/200r200/761268/3152.png",
	  "name__1": "Беседа. 50гр",
	  "price": 36.5,
	  "quantity": 41,
	  "removed": 0
	},
	{
	  "date": "2017-11-03 13:11:06",
	  "name": "Приход",
	  "id": 564564867361362,
	  "image": "https://www.komus.ru/medias/sys_master/root/hd3/h93/9286922043422.jpg",
	  "name__1": "Молочный Изюм 100",
	  "price": 102,
	  "quantity": 3,
	  "removed": 0
	},
	{
	  "date": "2017-11-03 13:11:06",
	  "name": "Приход",
	  "id": 564564867361362,
	  "image": "https://www.utkonos.ru/images/photo/3176/3176192H.jpg",
	  "name__1": "Сыр 125г",
	  "price": 131,
	  "quantity": 96,
	  "removed": 0
	},
	{
	  "date": "2017-11-03 13:11:06",
	  "name": "Приход",
	  "id": 564564867361362,
	  "image": "https://www.utkonos.ru/images/photo/3139/3139296H.jpg",
	  "name__1": "Тоник 0,5л",
	  "price": 63,
	  "quantity": 31,
	  "removed": 0
	},
	{
	  "date": "2017-11-03 13:11:06",
	  "name": "Приход",
	  "id": 564564867361362,
	  "image": "",
	  "name__1": "Парус лимон 1л",
	  "price": 150,
	  "quantity": 52,
	  "removed": 1
	},
	{
	  "date": "2017-11-03 13:11:06",
	  "name": "Приход",
	  "id": 564564867361362,
	  "image": "http://www.svoda.ru/site/userfiles/images/%D0%9A%D0%90%D0%9F%D0%9B%D0%AF%20%D0%A0%D0%9E%D0%A1%D0%AB%201.5%D0%9B%20%D0%93%D0%90%D0%97%D0%98%D0%A0%D0%9E%D0%92%D0%90%D0%9D%D0%9D%D0%90%D0%AF.jpg",
	  "name__1": "Капля росы негаз 1.5л",
	  "price": 16.9,
	  "quantity": 16,
	  "removed": 0
	},
	{
	  "date": "2017-11-03 13:11:06",
	  "name": "Приход",
	  "id": 564564867361362,
	  "image": "http://www.calorizator.ru/sites/default/files/imagecache/product_512/product/tvorog-prostokvashino-1.jpg",
	  "name__1": "Нежирный творог",
	  "price": 52.41,
	  "quantity": 81,
	  "removed": 0
	},
	{
	  "date": "2017-11-03 13:11:06",
	  "name": "Приход",
	  "id": 564564867361362,
	  "image": "http://ecosned.ru/image/cache/catalog/categories/iz_fermerskogo_moloka/tvorog/7/ge-catalog-categories-iz_fermerskogo_moloka-tvorog-tvorozhnaya_massa_s_kuragoy-800x800.jpg",
	  "name__1": "Творог 9% с курагой",
	  "price": 121,
	  "quantity": 23,
	  "removed": 0
	},
	{
	  "date": "2017-11-03 13:11:06",
	  "name": "Приход",
	  "id": 564564867361362,
	  "image": "https://tashkentcena.com/files/products/893eebe7b69146290886dc504a3328ef.jpeg",
	  "name__1": "Горький коньяк 100",
	  "price": 336,
	  "quantity": 52,
	  "removed": 0
	},
	{
	  "date": "2017-11-03 13:11:06",
	  "name": "Приход",
	  "id": 564564867361362,
	  "image": "https://www.utkonos.ru/images/photo/3054/3054289H.jpg",
	  "name__1": "Аленка карамель 100г Акционный товар Большая скидка",
	  "price": 73.9,
	  "quantity": 12,
	  "removed": 0
	},
	{
	  "date": "2017-11-29 17:26:57",
	  "name": "Приход",
	  "id": 564564867361365,
	  "image": "https://mariupolcena.com/files/products/9ff44136e6ccb0afb404ad26f727e67d.jpeg",
	  "name__1": "Русская картошка чедар 50",
	  "price": 46.3,
	  "quantity": 3,
	  "removed": 0
	},
	{
	  "date": "2017-11-29 17:26:57",
	  "name": "Приход",
	  "id": 564564867361365,
	  "image": "",
	  "name__1": "Виноград 0,3л",
	  "price": 65,
	  "quantity": 88,
	  "removed": 0
	},
	{
	  "date": "2017-11-29 17:26:57",
	  "name": "Приход",
	  "id": 564564867361365,
	  "image": "http://www.calorizator.ru/sites/default/files/imagecache/product_512/product/tvorog-prostokvashino-1.jpg",
	  "name__1": "Нежирный творог",
	  "price": 52.41,
	  "quantity": 20,
	  "removed": 0
	},
	{
	  "date": "2017-11-29 17:26:57",
	  "name": "Приход",
	  "id": 564564867361365,
	  "image": "https://www.utkonos.ru/images/photo/3139/3139296H.jpg",
	  "name__1": "Тоник 0,5л",
	  "price": 63,
	  "quantity": 64,
	  "removed": 0
	},
	{
	  "date": "2017-11-29 17:26:57",
	  "name": "Приход",
	  "id": 564564867361365,
	  "image": "http://produkty-online.ru/wa-data/public/shop/products/31/83/18331/images/1359/1359.970.jpg",
	  "name__1": "Молочный Сказка 100",
	  "price": 39,
	  "quantity": 54,
	  "removed": 0
	},
	{
	  "date": "2017-11-29 17:26:57",
	  "name": "Приход",
	  "id": 564564867361365,
	  "image": "",
	  "name__1": "Парус апельсин 1л",
	  "price": 150,
	  "quantity": 88,
	  "removed": 1
	},
	{
	  "date": "2017-11-29 17:26:57",
	  "name": "Приход",
	  "id": 564564867361365,
	  "image": "https://teremok.sm.ua/wa-data/public/shop/products/82/25/82582/images/35179/35179.750@2x.jpg",
	  "name__1": "Сметана и лук 25г",
	  "price": 30,
	  "quantity": 33,
	  "removed": 0
	},
	{
	  "date": "2017-11-29 17:26:57",
	  "name": "Приход",
	  "id": 564564867361365,
	  "image": "http://xn--4-8sbu.xn--p1ai/thumb/4KQdJOhw0Uu5AnP0PPIrMQ/200r200/761268/3152.png",
	  "name__1": "Беседа. 50гр",
	  "price": 36.5,
	  "quantity": 6,
	  "removed": 0
	},
	{
	  "date": "2017-11-29 17:26:57",
	  "name": "Приход",
	  "id": 564564867361365,
	  "image": "",
	  "name__1": "Парус лимон 1л",
	  "price": 150,
	  "quantity": 65,
	  "removed": 1
	},
	{
	  "date": "2017-11-29 18:29:00",
	  "name": "Расход",
	  "id": 564564867361364,
	  "image": "http://irecommend.ru/sites/default/files/imagecache/copyright1/user-images/299388/Ydfgl76IXe0nEM2gO6Ww.JPG",
	  "name__1": "Молочный Традиция 100",
	  "price": 115,
	  "quantity": 64,
	  "removed": 0
	},
	{
	  "date": "2017-11-29 19:31:03",
	  "name": "Приход",
	  "id": 564564867361363,
	  "image": "https://mariupolcena.com/files/products/9ff44136e6ccb0afb404ad26f727e67d.jpeg",
	  "name__1": "Русская картошка чедар 50",
	  "price": 46.3,
	  "quantity": 6,
	  "removed": 0
	},
	{
	  "date": "2017-11-29 19:31:03",
	  "name": "Приход",
	  "id": 564564867361363,
	  "image": "https://teremok.sm.ua/wa-data/public/shop/products/82/25/82582/images/35179/35179.750@2x.jpg",
	  "name__1": "Сметана и лук 25г",
	  "price": 30,
	  "quantity": 18,
	  "removed": 0
	},
	{
	  "date": "2017-11-29 19:31:03",
	  "name": "Приход",
	  "id": 564564867361363,
	  "image": "http://xn--4-8sbu.xn--p1ai/thumb/4KQdJOhw0Uu5AnP0PPIrMQ/200r200/761268/3152.png",
	  "name__1": "Беседа. 50гр",
	  "price": 36.5,
	  "quantity": 99,
	  "removed": 0
	},
	{
	  "date": "2017-11-29 19:31:03",
	  "name": "Приход",
	  "id": 564564867361363,
	  "image": "https://tashkentcena.com/files/products/893eebe7b69146290886dc504a3328ef.jpeg",
	  "name__1": "Горький коньяк 100",
	  "price": 336,
	  "quantity": 94,
	  "removed": 0
	},
	{
	  "date": "2017-11-29 19:31:03",
	  "name": "Приход",
	  "id": 564564867361363,
	  "image": "https://www.utkonos.ru/images/photo/3176/3176192H.jpg",
	  "name__1": "Сыр 125г",
	  "price": 131,
	  "quantity": 64,
	  "removed": 0
	},
	{
	  "date": "2017-11-29 19:31:03",
	  "name": "Приход",
	  "id": 564564867361363,
	  "image": "https://www.utkonos.ru/images/photo/3265/3265004H.jpg",
	  "name__1": "Молочный Яблоко 100",
	  "price": 25.1,
	  "quantity": 52,
	  "removed": 0
	},
	{
	  "date": "2017-11-29 19:31:03",
	  "name": "Приход",
	  "id": 564564867361363,
	  "image": "",
	  "name__1": "Парус апельсин 1л",
	  "price": 150,
	  "quantity": 43,
	  "removed": 1
	}
 ]


let myDb = {};
db.forEach(element=>{
	day=element.date.slice(0,10)
	console.log(day);
	if (!myDb[day]){
		myDb[day]={};
	}
	if(!myDb[day][element.id]){
		myDb[day][element.id]=[]
	}
	myDb[day][element.id].push(element);

})
console.log(myDb);






function numberToMonth(number){
	let months = ["Января","Февраля","Марта","Апреля","Мая","Июня","Июля","Августа","Сентября","Октября","Ноября","Декабря"]
return months[number-1]
}

function toggleDayVisibilityStatus(event){
	console.log(event.target.nextElementSibling.classList);
	
	event.target.nextElementSibling.classList.toggle("hidden");
	event.target.classList.toggle("hidden");
}

function toggleQuantityVisibility(event){
	//event.target.nextElementSibling.classList.toggle("hidden");
	event.target.classList.toggle("hidden");
	console.log(event.target.parentNode.nextSibling);
	event.target.parentNode.classList.toggle("hidden")
}

function objectSize(obj){
	let size = 0, key;
    for (key in obj) {
        if (obj.hasOwnProperty(key)) size++;
    }
    return size;
}

function calculateDayAmount(item){

	let key, sum=0;
	for (key in item) {
		console.log("rr",item[key]);
		item[key].forEach(invoice=>{
			sum+=invoice.price*invoice.quantity;
		})
	}
	return Math.round(sum*100)/100;
}

function calculateInvoiceAmount(item){
	let sum=0;
	item.forEach(invoice=>{
		sum+=invoice.price*invoice.quantity;
	})
	return Math.round(sum*100)/100;
}

function roundUp(price,quantity){
	return Math.round(price*quantity*100)/100;
}

function getPieces(quantity){
	let endings =["","а","и","и","и","","","","",""];
	return endings[quantity%10]
}


 // console.log("fdsdfsdfsdfsdf");

var res = nunjucks.render('views/page.njk',{ myDb: myDb,getPieces,roundUp,numberToMonth:numberToMonth,objectSize,calculateDayAmount,calculateInvoiceAmount});



// nunjucks.configure({ autoescape: true });
// let html = nunjucks.renderString('Hello {{ username }}', { username: 'James' });

// console.log(window.nunjucksPrevompiled);

// nunjucks.configure('/views', { autoescape: true });
// let html2 = nunjucks.render('page', { foo: 'bar' });




document.getElementById('nun').innerHTML = res;

let dayCardDate=document.getElementsByClassName("day-card-date");
console.log(dayCardDate);

Object.keys(dayCardDate).forEach(el=>{
	console.log(dayCardDate[el]);
	dayCardDate[el].addEventListener("click",(event)=>{
		toggleDayVisibilityStatus(event);
	})
});


let goodsQuantityOpener=document.getElementsByClassName("goods-quantity-opener");


Object.keys(goodsQuantityOpener).forEach(el=>{
	console.log(goodsQuantityOpener[el]);
	goodsQuantityOpener[el].addEventListener("click",(event)=>{
		toggleQuantityVisibility(event);
	})
});